<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>站内消息</title>
    <link rel="stylesheet" href="assets/layui/css/layui.css">
    <script src="assets/layui/layui.js" charset="utf-8"></script>
</head>
<body onload="getList()">

<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
    <ul class="layui-tab-title">
        <li class="layui-this">公告</li>
        <li>私信</li>
    </ul>
    <div class="layui-tab-content" style="height: 100px;">
        <!--公告，即OneToAll站内消息-->
        <div class="layui-tab-item layui-show">
            <ul class="layui-timeline" id="notice" style="margin:15px;padding:15px;background-color: white">
                <!-- <li class="layui-timeline-item">
                     <i class="layui-icon layui-timeline-axis"></i>
                     <div class="layui-timeline-content layui-text">
                         <h3 class="layui-timeline-title">日期</h3>
                         <p>
                             发布人
                             <br>内容
                             <br>备注
                         </p>
                     </div>
                 </li>-->
                <!-- <li class="layui-timeline-item">
                     <i class="layui-icon layui-timeline-axis"></i>
                     <div class="layui-timeline-content layui-text">
                         <div class="layui-timeline-title">过去</div>
                     </div>
                 </li>-->
            </ul>
        </div>
        <!--私信，即OneToOne站内消息-->
        <div class="layui-tab-item" style="padding: 15px;background-color: #F2F2F2">
            <div id="message">
                <!-- <div class="layui-card">
                     <div class="layui-card-header">日期</div>
                     <div class="layui-card-body">
                         <p>标题 <em>发送人</em></p>
                         <ul>
                             <li>内容</li>
                             <li>备注</li>
                         </ul>
                     </div>
                 </div>-->
            </div>
        </div>
    </div>
</div>

<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>


    var json
    layui.use('element', function () {
        var element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        element.on('tab(filter)', function(data){
            console.log(this); //当前Tab标题所在的原始DOM元素
            console.log(data.index); //得到当前Tab的所在下标
            console.log(data.elem); //得到当前的Tab大容器
        });


    });

    function getList() {
        layui.$.ajax({
            type: "GET",
            url: "pm/findAll",
            dataType: "json",
            success: function (result) {
                json = result
                // console.log(json)
                initTimeLine()
                initCardM()
            },
            error: function (result) {
                console.log(result)
            }
        })
        var monthFlag

        function initTimeLine() {//将获取到的message表的内容填充到时间线中
            monthFlag = 13
            for (var i = 0; i < json.length; i++) {
                //result[i]表示获得第i个json对象即JSONObject
                //result[i]通过.字段名称即可获得指定字段的值
                if (json[i].type == 0)
                    layui.$("#notice").prepend("<li class=\"layui-timeline-item\">\n" +
                        "                    <i class=\"layui-icon layui-timeline-axis\"></i>\n" +
                        "                    <div class=\"layui-timeline-content layui-text\">\n" +
                        "                        <h3 class=\"layui-timeline-title\">" + dateToStr(json[i].date) + "</h3>\n" +
                        "                        <p>\n" +
                        "                            发布人:" + json[i].sender + "\n" +
                        "                            <br>" + json[i].title + "\n" +
                        "                            <br>" + json[i].content + "\n" +
                        "                            <br>" + json[i].remark + "\n" +
                        "                        </p>\n" +
                        "                    </div>\n" +
                        "                </li>")
            }
            layui.$("#notice").append("  <li class=\"layui-timeline-item\">\n" +
                "                    <i class=\"layui-icon layui-timeline-axis\"></i>\n" +
                "                    <div class=\"layui-timeline-content layui-text\">\n" +
                "                        <div class=\"layui-timeline-title\">过去</div>\n" +
                "                    </div>\n" +
                "                </li>")
        }

        function initCardM() {//将获取到的message表的内容填充到时间线中
            monthFlag = 13
            for (var i = 0; i < json.length; i++) {
                //result[i]表示获得第i个json对象即JSONObject
                //result[i]通过.字段名称即可获得指定字段的值
                if (json[i].type == 1)
                    layui.$("#message").prepend(" <div class=\"layui-card\">\n" +
                        "                <div class=\"layui-card-header\">" + dateToStr(json[i].date) + "</div>\n" +
                        "                <div class=\"layui-card-body\">\n" +
                        "                    <p>" + json[i].title + "<em>" + json[i].sender + "</em></p>\n" +
                        "                    <ul>\n" +
                        "                        <li>" + json[i].content + "</li>\n" +
                        "                        <li>" + json[i].remark + "</li>\n" +
                        "                    </ul>\n" +
                        "                </div>\n" +
                        "            </div>")
            }
        }

        function dateToStr(date) {
            var date = new Date(date);
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            m = m < 10 ? '0' + m : m;
            var d = date.getDate();
            d = d < 10 ? ("0" + d) : d;
            var h = date.getHours();
            h = h < 10 ? ("0" + h) : h;
            var M = date.getMinutes();
            M = M < 10 ? ("0" + M) : M;
            var str;
            if (m<monthFlag) {
                str = y + "年" + m + "月" + d + "日" + h + ":" + M;
                monthFlag = m;
            }
            if (m >= monthFlag)
                str = m + "月" + d + "日" + h + ":" + M;
            return str;
        }
    }
</script>


</body>
</html>